---
layout: generate
title: 嵌入式设备中的Linux引导方式
date: 2019-11-03 00:28:28
tags: Linux, Uboot, Bootloader, Bios, Arm
---

## 概述

主要是总结Linux的引导过程，包括
+ 从开机到控制权交接给内核
+ 内核初始化过程
+ 用户空间初始化过程

本篇blog将涉及但不限于以下概念：
+ Bios/Bootloader
+ Uboot的一般用法
+ 根文件系统
+ 嵌入式设备


## 嵌入式设备的关键属性

本篇blog是围绕着嵌入式设备展开的，因此，首先，将先明确下，什么是嵌入式设备？嵌入式设备和非嵌入式设备的区别是什么？

嵌入式设备和非嵌入式设备并没有明确的界限，嵌入式设备通常具有以下属性：
+ 包含一个处理引擎，比如通用微处理器
+ 一般是针对某种具体的应用或目的设计的
+ 用户界面通常不是考量的关键因素，甚至会为了安全性而牺牲一部分可用性
+ 资源通常受限，比如没有硬盘，供电受限等等
+ 应用程序通常是内置的，出厂时，软硬件均已经集成完善。

## 从开机到控制权交接给内核

对于这一过程的概述，嵌入式设备和一般的桌面PC设备稍有差别，也可以说是ARM世界和x86世界的差别。

在一般的桌面PC系统中，通电之后，Bios立刻接管了设备，在完成硬件自检等工作后，跳转，将控制权交给Bootloader，如果硬盘里不只安装了一个系统，在Bootloader这一步可以决定启动哪一个操作系统。在这个语境中，Bios被称为“first-stage boot loader”，bootloader被称为“first-stage boot loader”。主流的Bootloader包括bootmgr, grub等等。

在嵌入式设备中，通常不会有多个系统的情况，因此，不需要将整个引导过程拆成两步进行。所以，嵌入式设备中，很少使用bios的概念，而是直接将两个步骤统称为 bootloader，本文以下内容涉及到的bootloader，除非特别说明，都是指嵌入式开发中的概念。

在嵌入式设备中，bootloader的关键职能，包括：
+ 初始化关键的硬件，比如SDRAM控制器，I/O控制器和图形控制器
+ 为外设控制器分配必要的系统资源，比如内存和中断电路
+ 提供一个定位和加载操作系统镜像的机制
+ 加载操作系统，并将控制权移交给它，同时传递必要的启动信息。内容可能包括内存总容量、时钟频率、串行端口频率（波特率）等等

嵌入式开发过程中，使用最为广泛的bootloader便是U-Boot。本文不会过多的涉及U-Boot的内容，以避免行文过于臃肿，简单介绍下U-Boot的用法。

-----------------------

+ 加载内容镜像到固定内存地址

```
tftp 600000 uImage
```

+ 加载dtb到固定内存位置
```
tftp c00000 dtb
```
dtb是arm linux中描述硬件的方式，其中文全称为“扁平设备树”。

+ 根据之前的dtb开始引导系统
```
bootm 600000 - c00000
```
-----------------------
+ 从磁盘引导
```
diskboot Ox400000 0:0
```
此处中的0：0指第一个IDE设备的第一个分区

+ 从磁盘中的镜像开始引导
```
bootm Ox400000
```

有点困了，待填坑.....

## 补充
### dtb,dts,dtc介绍及常用用法

## 推荐拓展内容
+ BIOS-MBR 与 GPT-UEFI
+ GRUB, GRUB2
+ ROM 与 EEPROM
+ U-boot
+ dtb, dtc, dts

## 参考

+ 《嵌入式LINUX基础教程（第2版）》 第1章至第7章
+ [The BIOS/MBR Boot Process](https://neosmart.net/wiki/mbr-boot-process/)